<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>THEE ARCHIVE - Server Test</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      color: #fff;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
    }
    
    h1 {
      font-size: 2rem;
      margin-bottom: 1rem;
      text-align: center;
    }
    
    .card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .status {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
      border-radius: 12px;
      margin-bottom: 12px;
      font-weight: 500;
    }
    
    .status.pending {
      background: rgba(255, 255, 255, 0.1);
    }
    
    .status.success {
      background: rgba(34, 197, 94, 0.2);
      border: 1px solid rgba(34, 197, 94, 0.4);
    }
    
    .status.error {
      background: rgba(239, 68, 68, 0.2);
      border: 1px solid rgba(239, 68, 68, 0.4);
    }
    
    .icon {
      font-size: 24px;
    }
    
    button {
      background: linear-gradient(135deg, #f59e0b, #d97706);
      color: white;
      border: none;
      padding: 12px 32px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s;
      width: 100%;
    }
    
    button:hover {
      transform: translateY(-2px);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    pre {
      background: rgba(0, 0, 0, 0.3);
      padding: 16px;
      border-radius: 8px;
      overflow-x: auto;
      font-size: 14px;
      margin-top: 12px;
    }
    
    .info {
      background: rgba(59, 130, 246, 0.2);
      border: 1px solid rgba(59, 130, 246, 0.4);
      padding: 16px;
      border-radius: 12px;
      margin-bottom: 20px;
    }
    
    .info code {
      background: rgba(0, 0, 0, 0.3);
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üé¨ THEE ARCHIVE - Server Test</h1>
    
    <div class="info">
      <strong>üìç Project ID:</strong> <code>avvwsbiqgtjcwphadypu</code><br>
      <strong>üåê Function Name:</strong> <code>make-server-4d451974</code>
    </div>
    
    <div class="card">
      <h2>Server Status Tests</h2>
      
      <div id="healthStatus" class="status pending">
        <span class="icon">‚è≥</span>
        <span>Health Check - Not tested yet</span>
      </div>
      
      <div id="moviesStatus" class="status pending">
        <span class="icon">‚è≥</span>
        <span>Movies Endpoint - Not tested yet</span>
      </div>
      
      <div id="gmStatus" class="status pending">
        <span class="icon">‚è≥</span>
        <span>GM Feed Endpoint - Not tested yet</span>
      </div>
      
      <button onclick="runTests()" id="testButton">üöÄ Run Server Tests</button>
    </div>
    
    <div class="card">
      <h2>Test Results</h2>
      <pre id="results">Click "Run Server Tests" to begin...</pre>
    </div>
    
    <div class="card">
      <h2>Quick Deploy</h2>
      <p>If tests fail, deploy the server with these commands:</p>
      <pre>supabase login
supabase link --project-ref avvwsbiqgtjcwphadypu
supabase functions deploy make-server-4d451974</pre>
    </div>
  </div>
  
  <script>
    const PROJECT_ID = 'avvwsbiqgtjcwphadypu';
    const ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF2dndzYmlxZ3RqY3dwaGFkeXB1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI4MTI2ODksImV4cCI6MjA3ODM4ODY4OX0.KDup_c59yIl2NHkREqClHyvxcRaGOYf5_xggfmYVy4c';
    const BASE_URL = `https://${PROJECT_ID}.supabase.co/functions/v1/make-server-4d451974`;
    
    let logs = [];
    
    function log(message) {
      const timestamp = new Date().toLocaleTimeString();
      logs.push(`[${timestamp}] ${message}`);
      document.getElementById('results').textContent = logs.join('\n');
    }
    
    function setStatus(id, state, message) {
      const el = document.getElementById(id);
      el.className = `status ${state}`;
      const icon = state === 'success' ? '‚úÖ' : state === 'error' ? '‚ùå' : '‚è≥';
      el.innerHTML = `<span class="icon">${icon}</span><span>${message}</span>`;
    }
    
    async function testHealth() {
      log('üè• Testing health check endpoint...');
      log(`URL: ${BASE_URL}/health`);
      
      try {
        const response = await fetch(`${BASE_URL}/health`, {
          headers: {
            'Authorization': `Bearer ${ANON_KEY}`
          }
        });
        
        log(`Response status: ${response.status}`);
        
        if (response.ok) {
          const data = await response.json();
          log(`Response data: ${JSON.stringify(data)}`);
          setStatus('healthStatus', 'success', 'Health Check - ‚úÖ Server is running!');
          return true;
        } else {
          const text = await response.text();
          log(`Error response: ${text}`);
          setStatus('healthStatus', 'error', `Health Check - ‚ùå Error ${response.status}`);
          return false;
        }
      } catch (error) {
        log(`‚ùå Health check failed: ${error.message}`);
        setStatus('healthStatus', 'error', 'Health Check - ‚ùå Server not accessible');
        return false;
      }
    }
    
    async function testMovies() {
      log('\nüé¨ Testing movies endpoint...');
      log(`URL: ${BASE_URL}/movies`);
      
      try {
        const response = await fetch(`${BASE_URL}/movies`, {
          headers: {
            'Authorization': `Bearer ${ANON_KEY}`
          }
        });
        
        log(`Response status: ${response.status}`);
        
        if (response.ok) {
          const data = await response.json();
          log(`Response data: ${JSON.stringify(data).substring(0, 200)}...`);
          
          if (data.success) {
            const count = data.movies ? data.movies.length : 0;
            setStatus('moviesStatus', 'success', `Movies Endpoint - ‚úÖ ${count} movies loaded`);
            return true;
          } else {
            setStatus('moviesStatus', 'error', 'Movies Endpoint - ‚ùå Success=false');
            return false;
          }
        } else {
          const text = await response.text();
          log(`Error response: ${text}`);
          setStatus('moviesStatus', 'error', `Movies Endpoint - ‚ùå Error ${response.status}`);
          return false;
        }
      } catch (error) {
        log(`‚ùå Movies test failed: ${error.message}`);
        setStatus('moviesStatus', 'error', 'Movies Endpoint - ‚ùå Failed');
        return false;
      }
    }
    
    async function testGM() {
      log('\n‚ú® Testing GM feed endpoint...');
      log(`URL: ${BASE_URL}/gm-posts`);
      
      try {
        const response = await fetch(`${BASE_URL}/gm-posts`, {
          headers: {
            'Authorization': `Bearer ${ANON_KEY}`
          }
        });
        
        log(`Response status: ${response.status}`);
        
        if (response.ok) {
          const data = await response.json();
          log(`Response data: ${JSON.stringify(data).substring(0, 200)}...`);
          
          if (data.success) {
            const count = data.posts ? data.posts.length : 0;
            setStatus('gmStatus', 'success', `GM Feed Endpoint - ‚úÖ ${count} posts loaded`);
            return true;
          } else {
            setStatus('gmStatus', 'error', 'GM Feed Endpoint - ‚ùå Success=false');
            return false;
          }
        } else {
          const text = await response.text();
          log(`Error response: ${text}`);
          setStatus('gmStatus', 'error', `GM Feed Endpoint - ‚ùå Error ${response.status}`);
          return false;
        }
      } catch (error) {
        log(`‚ùå GM test failed: ${error.message}`);
        setStatus('gmStatus', 'error', 'GM Feed Endpoint - ‚ùå Failed');
        return false;
      }
    }
    
    async function runTests() {
      const button = document.getElementById('testButton');
      button.disabled = true;
      button.textContent = '‚è≥ Running tests...';
      
      logs = [];
      log('üöÄ Starting server tests...');
      log(`Project: ${PROJECT_ID}`);
      log(`Base URL: ${BASE_URL}`);
      log('');
      
      const healthOk = await testHealth();
      
      if (healthOk) {
        await testMovies();
        await testGM();
      } else {
        log('\n‚ö†Ô∏è Skipping other tests because health check failed.');
        log('');
        log('üîß DEPLOYMENT REQUIRED:');
        log('The server is not accessible. Please deploy it using:');
        log('  supabase functions deploy make-server-4d451974');
      }
      
      log('\n‚úÖ Tests complete!');
      
      button.disabled = false;
      button.textContent = 'üîÑ Run Tests Again';
    }
  </script>
</body>
</html>
